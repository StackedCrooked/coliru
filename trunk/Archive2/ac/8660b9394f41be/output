0000000: 0102 0304 0506 2369 6e63 6c75 6465 203c  ......#include <
0000010: 6663 6e74 6c2e 683e 0a23 696e 636c 7564  fcntl.h>.#includ
0000020: 6520 3c73 7464 6c69 622e 683e 0a23 696e  e <stdlib.h>.#in
0000030: 636c 7564 6520 3c73 7472 696e 672e 683e  clude <string.h>
0000040: 0a23 696e 636c 7564 6520 3c73 7973 2f6d  .#include <sys/m
0000050: 6d61 6e2e 683e 0a23 696e 636c 7564 6520  man.h>.#include 
0000060: 3c73 7973 2f73 7461 742e 683e 0a23 696e  <sys/stat.h>.#in
0000070: 636c 7564 6520 3c73 7973 2f74 7970 6573  clude <sys/types
0000080: 2e68 3e0a 2369 6e63 6c75 6465 203c 756e  .h>.#include <un
0000090: 6973 7464 2e68 3e0a 0a76 6f69 6420 7072  istd.h>..void pr
00000a0: 6570 656e 6428 636f 6e73 7420 6368 6172  epend(const char
00000b0: 2a20 666e 616d 652c 2063 6861 7220 636f  * fname, char co
00000c0: 6e73 742a 2070 7265 7065 6e64 5f64 6174  nst* prepend_dat
00000d0: 612c 2073 697a 655f 7420 6e29 0a7b 0a20  a, size_t n).{. 
00000e0: 2020 2073 7472 7563 7420 7374 6174 2073     struct stat s
00000f0: 3b0a 2020 2020 7374 6174 2866 6e61 6d65  ;.    stat(fname
0000100: 2c20 2673 293b 0a20 2020 2073 697a 655f  , &s);.    size_
0000110: 7420 7369 7a65 2020 2020 3d20 732e 7374  t size    = s.st
0000120: 5f73 697a 653b 0a20 2020 2073 697a 655f  _size;.    size_
0000130: 7420 7265 7369 7a65 6420 3d20 7369 7a65  t resized = size
0000140: 202b 206e 3b0a 0a20 2020 2074 7275 6e63   + n;..    trunc
0000150: 6174 6528 666e 616d 652c 2072 6573 697a  ate(fname, resiz
0000160: 6564 293b 0a20 2020 2069 6e74 2066 6420  ed);.    int fd 
0000170: 3d20 6f70 656e 2866 6e61 6d65 2c20 4f5f  = open(fname, O_
0000180: 5244 5752 293b 0a20 2020 2063 6861 722a  RDWR);.    char*
0000190: 206d 6170 7065 645f 6669 6c65 203d 2028   mapped_file = (
00001a0: 766f 6964 2a29 206d 6d61 7028 4e55 4c4c  void*) mmap(NULL
00001b0: 2c20 7265 7369 7a65 642c 2050 524f 545f  , resized, PROT_
00001c0: 5245 4144 207c 2050 524f 545f 5752 4954  READ | PROT_WRIT
00001d0: 452c 204d 4150 5f53 4841 5245 442c 2066  E, MAP_SHARED, f
00001e0: 642c 2030 293b 0a0a 2020 2020 6d65 6d6d  d, 0);..    memm
00001f0: 6f76 6528 6d61 7070 6564 5f66 696c 6520  ove(mapped_file 
0000200: 2b20 6e2c 206d 6170 7065 645f 6669 6c65  + n, mapped_file
0000210: 2c20 7369 7a65 293b 0a20 2020 206d 656d  , size);.    mem
0000220: 6370 7920 286d 6170 7065 645f 6669 6c65  cpy (mapped_file
0000230: 2c20 7072 6570 656e 645f 6461 7461 2c20  , prepend_data, 
0000240: 6e29 3b0a 7d0a 0a69 6e74 206d 6169 6e28  n);.}..int main(
0000250: 2920 7b0a 2020 2020 6368 6172 2063 6f6e  ) {.    char con
0000260: 7374 2074 6f5f 7072 6570 656e 645b 5d20  st to_prepend[] 
0000270: 3d20 7b20 312c 322c 332c 342c 352c 3620  = { 1,2,3,4,5,6 
0000280: 7d3b 0a20 2020 2070 7265 7065 6e64 2822  };.    prepend("
0000290: 6461 7461 2e64 6174 222c 2074 6f5f 7072  data.dat", to_pr
00002a0: 6570 656e 642c 2073 697a 656f 6620 746f  epend, sizeof to
00002b0: 5f70 7265 7065 6e64 293b 0a20 2020 2072  _prepend);.    r
00002c0: 6574 7572 6e20 303b 0a7d 0a              eturn 0;.}.
